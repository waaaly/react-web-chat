(this["webpackJsonpweb-chat"]=this["webpackJsonpweb-chat"]||[]).push([[4],{597:function(e,a,t){},598:function(e,a,t){},599:function(e,a,t){},602:function(e,a,t){},603:function(e,a,t){},606:function(e,a,t){},609:function(e,a,t){"use strict";t.r(a);var n=t(0),c=t.n(n),r=(t(597),t(110)),s=t(43);t(598);var l=function(){var e=Object(r.b)();return c.a.createElement(s.a,null,(function(){return c.a.createElement("div",{className:"chat-to-header-wrapper"},c.a.createElement("div",{className:"chat-info"},c.a.createElement("div",{className:"avatar"},c.a.createElement("img",{src:e.chat.avatar,alt:""})),c.a.createElement("div",{className:"chat-name"},e.chat.nickname)))}))},o=(t(76),t(28)),i=(t(226),t(75)),u=t(26),m=(t(599),t(612)),d=t(613),f=t(310),p=t(49),b=t(607),v=(t(601),t(311),t(227)),E=t(140),g=t(9),h=t.n(g),I=t(23),j=(t(602),t(47)),O=t(309),k=t(40),N=(t(149),t(95)),y=(t(150),t(79)),w=(t(109),t(41)),S=t(74),C=t(610),L=t(611),T=t(190),x=(t(603),{showUploadList:!1,action:"http://1.12.246.138:3000/api/",headers:{Authorization:Object(k.b)()}});function A(e){var a=Object(S.a)(Object(S.a)({},x),{},{name:"picture",action:x.action+"savePicture",maxCount:1,beforeUpload:function(e){console.log(e);return!!/\/(png|jpg|gif|jpeg|webp)$/.test(e.type)||(w.b.error("\u6682\u4e0d\u652f\u6301\u7684\u6587\u4ef6\u683c\u5f0f"),!1)},onChange:function(a){var t=a.file;if("done"===t.status){var n=t.response.filename;return console.log(n),e.onUploadSuccess("http://1.12.246.138:4000/picture/".concat(n))}}});return c.a.createElement(v.a,a,c.a.createElement(o.a,{className:"chat-tool-btn"},c.a.createElement(C.a,null)))}function F(e){var a=Object(n.useState)(!1),t=Object(u.a)(a,2),r=t[0],s=t[1],l=Object(j.a)().request;function i(){return(i=Object(I.a)(h.a.mark((function a(t){var n,c,r;return h.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return n=t.split("/"),c=n[n.length-1],a.next=4,l({filename:c});case 4:r=a.sent.data,console.log(r),r.data&&(e.onDeleteSuccess(t),w.b.success(r.message));case 7:case"end":return a.stop()}}),a)})))).apply(this,arguments)}return c.a.createElement("div",null,c.a.createElement(o.a,{className:"chat-tool-btn",onClick:function(){s(!0)}},c.a.createElement(L.a,null)),c.a.createElement(N.a,{title:"\u8868\u60c5\u7ba1\u7406(".concat(e.facebagList.length,")"),centered:!0,visible:r,onOk:function(){s(!1)},cancelButtonProps:{style:{display:"none"}},width:1e3},c.a.createElement("div",null,e.facebagList.map((function(e){return c.a.createElement(y.a,{key:e,placement:"topRight",color:"red",title:c.a.createElement("div",{onClick:function(){!function(e){i.apply(this,arguments)}(e)}},c.a.createElement(T.a,null))},c.a.createElement("img",{className:"facebag-img",src:e}))})))))}function M(e){var a=Object(n.useState)([]),t=Object(u.a)(a,2),r=t[0],s=t[1],l=Object(j.c)().request,i={name:"facebag",multiple:!0,showUploadList:!1,action:"http://1.12.246.138:3000/api/saveFacebag",headers:{Authorization:Object(k.b)()},onChange:function(e){console.log(e);var a=e.file;if("done"===a.status){var t=a.response.filename;console.log(t);var n=r;n.push("http://1.12.246.138:3000/facebag/".concat(t)),s(n)}}};return Object(n.useEffect)((function(){Object(I.a)(h.a.mark((function e(){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l();case 2:a=e.sent.data.data.facebagList,s(a);case 4:case"end":return e.stop()}}),e)})))()}),[]),c.a.createElement("div",{className:"face-bag-scroll"},c.a.createElement(F,{facebagList:r,onDeleteSuccess:function(e){console.log(e);var a=r,t=a.indexOf(e);a.splice(t,1),s(Object(E.a)(a))}}),c.a.createElement("ul",{className:"face-bag-ul"},r.map((function(a){return c.a.createElement("li",{onClick:function(){return e.onSelect(a)},key:a,className:"face-bag-ul-li"},c.a.createElement("img",{src:a}))})),c.a.createElement("li",{className:"face-bag-ul-li"},c.a.createElement(v.a,i,c.a.createElement(o.a,{className:"face-bag-ul-li-btn"},c.a.createElement(O.a,null))))))}var P=t(225),R=t.n(P),_=(t(604),t(312));var U=function(){var e=Object(p.b)(),a=Object(r.b)(),t=e.socket,s=i.a.useForm(),l=Object(u.a)(s,1)[0],v=Object(n.useState)(!1),E=Object(u.a)(v,2),g=E[0],h=E[1],I=Object(n.useState)(!1),j=Object(u.a)(I,2),O=j[0],k=j[1],N=Object(n.useRef)(null),y=function(){var n=l.getFieldsValue().message;if(w(n)){var c={userId:e.user.userInfo.userId,toId:"",avatar:e.user.userInfo.avatar,nickname:e.user.userInfo.nickname,message:R.a.createEditorState(n).toHTML(),type:"text"};a.chat.userId.includes("group")?t.emit("sendToAll",c):(c.toId=a.chat.userId,t.emit("sendToPrivate",c)),N.current.clearEditorContent()}},w=function(e){for(var a=!0,t=R.a.createEditorState(e).toRAW(!0),n=0;n<t.blocks.length;n++)if(t.blocks[n].text.trim()||"atomic"===t.blocks[n].type){a=!1;break}return!a};return c.a.createElement("div",{className:"chat-send-wrapper"},c.a.createElement("div",{className:g?"emoji-pop":"pop-none"},c.a.createElement(b.a,{onClick:function(e){l.setFieldsValue({message:_.ContentUtils.insertText(R.a.createEditorState(l.getFieldsValue().message),e.native)})}})),c.a.createElement("div",{className:O?"emoji-pop":"pop-none"},c.a.createElement(M,{onSelect:function(n){console.log(n);var c={userId:e.user.userInfo.userId,toId:"",avatar:e.user.userInfo.avatar,nickname:e.user.userInfo.nickname,message:n,type:"facebag"};a.chat.userId.includes("group")?t.emit("sendToAll",c):(c.toId=a.chat.userId,t.emit("sendToPrivate",c))}})),c.a.createElement("div",{className:"tool-bar"},c.a.createElement(o.a,{className:"btn-icon",onClick:function(){h(!g),k(!1)}},c.a.createElement(m.a,null)),c.a.createElement(o.a,{className:"btn-icon",onClick:function(){h(!1),k(!O)}},c.a.createElement(d.a,null)),c.a.createElement(A,{onUploadSuccess:function(n){console.log(n);var c={userId:e.user.userInfo.userId,toId:"",avatar:e.user.userInfo.avatar,nickname:e.user.userInfo.nickname,message:n,type:"img"};a.chat.userId.includes("group")?t.emit("sendToAll",c):(c.toId=a.chat.userId,t.emit("sendToPrivate",c))}})),c.a.createElement(i.a,{form:l,className:"form-row"},c.a.createElement(i.a.Item,{className:"input-send",name:"message"},c.a.createElement(R.a,{ref:N,controls:["media"],handleKeyCommand:function(e,a){return"split-block"===e?(y(),"handled"):"not-handled"},onFocus:function(){h(!1),k(!1)}})),c.a.createElement(i.a.Item,null,c.a.createElement("button",{className:"btn-send",onClick:y},c.a.createElement(f.a,null)))))},G=(t(595),t(596)),q=(t(606),t(608)),H=["src","srcList","children"];function V(e){var a,t=e.src,n=e.srcList,r=e.children,s=Object(q.a)(e,H),l=String(Math.random()).substring(2);return c.a.createElement(c.a.Fragment,null,e.children&&c.a.createElement("div",{onClick:function(){var e;null===(e=document.getElementById(l))||void 0===e||e.click()},style:{cursor:"pointer"}},r),n&&n.length?c.a.createElement(G.a.PreviewGroup,null,null===(a=e.srcList)||void 0===a?void 0:a.map((function(e,a){return c.a.createElement(G.a,Object.assign({id:l+(a||""),key:e,src:e},s,{hidden:r}))}))):t&&c.a.createElement(G.a,Object.assign({id:l,src:t},s,{hidden:r})))}V.Group=G.a.PreviewGroup;var W=V,z=Object(s.b)((function(){var e=Object(p.b)(),a=Object(r.b)();Object(n.useEffect)((function(){var e=document.querySelector("#R_chat_content");e&&(e.scrollTop=e.scrollHeight)}));var t=function(e){var a=[],t=R.a.createEditorState(e).toRAW(!0);for(var n in t.entityMap)"IMAGE"===t.entityMap[n].type&&a.push(t.entityMap[n].data.url);return a};return c.a.createElement("div",{className:"chat-records-wrapper"},a.chat.currentRecords.map((function(n){return c.a.createElement("div",{className:"message".concat(n.fromId===e.user.userInfo.userId?" self":""),key:n._id},c.a.createElement("div",{className:"message-wrapper"},c.a.createElement("div",{className:"message-content"},n.fromId!==e.user.userInfo.userId&&a.chat.userId.includes("group")?c.a.createElement("h6",null,n.nickname):null,["img","facebag"].includes(n.type)?c.a.createElement(G.a,{src:n.message,alt:n.message}):c.a.createElement(W,{srcList:t(n.message)},c.a.createElement("div",{dangerouslySetInnerHTML:{__html:n.message}})))),c.a.createElement("div",{className:"message-options"},c.a.createElement("div",{className:"avatar"},c.a.createElement("img",{src:n.avatar,alt:n.nickname})),c.a.createElement("span",{className:"message-date"},n.time)))})))})),B=Object(s.b)((function(){var e=Object(r.b)();return c.a.createElement("div",{className:"chat-content-wrapper"},e.chat.userId?c.a.createElement(c.a.Fragment,null,c.a.createElement(l,null),c.a.createElement("div",{className:"chat-content hidden-scrollbar",id:"R_chat_content"},c.a.createElement(z,null)),c.a.createElement(U,null)):c.a.createElement("div",{className:"chat-content-null"},c.a.createElement("p",null,"\u6b22\u8fce\u4f7f\u7528 WebChat")))}));a.default=B}}]);
//# sourceMappingURL=4.6810de6c.chunk.js.map